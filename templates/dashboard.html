<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å®¢æµæ€åŠ¿æ§åˆ¶å°</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      display: grid;
      grid-template-columns: 200px 1fr;
      height: 100vh;
      margin: 0;
      font-family: "Microsoft YaHei", sans-serif;
    }
    .sidebar {
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 20px;
    }
    .sidebar a {
      display: block;
      margin-bottom: 10px;
      padding: 10px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      color: #2c7be5;
      background: #e6f0ff;
    }
    .sidebar a.active {
      background: #2c7be5;
      color: white;
    }
    .container {
      padding: 20px;
      overflow-y: auto;
    }
    .section { display: none; }
    .active-section { display: block; }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    .card {
  position: relative;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  overflow: hidden;
}

/* æ¸å˜èƒŒæ™¯å¡ç‰‡ */
.card-pink {
  background: linear-gradient(135deg, #fdecec, #fff);
}
.card-blue {
  background: linear-gradient(135deg, #e9f3fc, #fff);
}
.card-orange {
  background: linear-gradient(135deg, #fff5e5, #fff);
}
.card-lightpink {
  background: linear-gradient(135deg, #fef0ef, #fff);
}

/* èƒŒæ™¯åœ†å›¾æ¡ˆ */
.card-pink::after,
.card-blue::after,
.card-orange::after,
.card-lightpink::after {
  content: '';
  position: absolute;
  bottom: -10px;
  right: -10px;
  width: 80px;
  height: 80px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  pointer-events: none;
}

    .card-title { font-weight: bold; margin-bottom: 10px; }
    .highlight { font-size: 24px; font-weight: bold; color: #2c7be5; }
    .subtext { color: #888; font-size: 14px; }
    .badge-red { background: #f56c6c !important; color: white; padding: 2px 6px; border-radius: 8px; font-size: 12px; }
    .badge-blue { background: #409eff !important; color: white; padding: 2px 6px; border-radius: 8px; font-size: 12px; }
    /* .card-pink { background: #fdecec; }
    .card-blue { background: #e9f3fc; }
    .card-orange { background: #fff5e5; }
    .card-lightpink { background: #fef0ef; } */
    .warning-card { margin-top: 10px; padding: 10px; border-radius: 8px; }
    .warning-red { background: #fdecec; border-left: 4px solid red; }
    .warning-blue { background: #e9f3fc; border-left: 4px solid #409eff; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h5>å¯¼èˆª</h5>
    <a id="nav-dashboard" onclick="switchSection('dashboard')" class="active">ğŸ“Š æ§åˆ¶å°</a>
    <a id="nav-map" onclick="switchSection('map')">ğŸš‡ è½¦ç«™çƒ­åŠ›å›¾</a>
    <a id="nav-list" onclick="switchSection('list')">ğŸ“‹ äººæµé‡åˆ—è¡¨</a>
    

  </div>

  <div class="container">
    <!-- æ§åˆ¶å°æ¨¡å— -->
    <div id="dashboard" class="section active-section">
      <h4>ğŸ“Š æ§åˆ¶å°ä¸»è§†å›¾</h4>
      <div class="grid">
  <div class="card card-pink">
    <div class="card-title">24å°æ—¶è¥¿ç«™ä¸œå¹¿åœºå‡ºç«™å£é—¸æœº1<br>ç¬¬ 1 çº§å®¢æµé¢„è­¦ <span class="badge-red">3 åˆ†é’Ÿè§¦å‘</span></div>
    <div class="highlight">é¢„è®¡ 200 äºº</div>
    <div class="subtext">é¢„è®¡ç–æ•£æ—¶é—´ï¼š8 åˆ†é’Ÿ</div>
  </div>

  <div class="card card-blue">
    <div class="card-title">24å°æ—¶è¥¿ç«™ä¸œå¹¿åœºå‡ºç«™å£é—¸æœº2<br>ç¬¬ 2 çº§å®¢æµé¢„è­¦ <span class="badge-blue">2 åˆ†é’Ÿè§¦å‘</span></div>
    <div class="highlight">é¢„è®¡ 100 äºº</div>
    <div class="subtext">é¢„è®¡ç–æ•£æ—¶é—´ï¼š6 åˆ†é’Ÿ</div>
  </div>
</div>

<h5>å‡ºç§Ÿè½¦ä¸Šå®¢æµé‡é¢„ä¼°</h5>
<div class="grid">
  <div class="card card-orange">
    <div class="card-title">ğŸš– å‡ºç§Ÿè½¦</div>
    <div class="highlight">ç­‰è½¦ 113 å°</div>
    <div class="subtext">å®¢æµé¢„æµ‹ 305 äºº</div>
  </div>
  <div class="card card-lightpink">
    <div class="card-title">ğŸš— ç½‘çº¦è½¦</div>
    <div class="highlight">ç­‰è½¦ 245 å°</div>
    <div class="subtext">å®¢æµé¢„æµ‹ 750 äºº</div>
  </div>
</div>


      <div class="grid">
        <div class="card">
          <div class="card-title">ğŸ‘¥ å®¢æµæ€§åˆ«æ¯”ä¾‹</div>
          <div id="pieChart" style="height: 300px;"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“ˆ 24å°æ—¶äººæµè¶‹åŠ¿</div>
          <div id="lineChart" style="height: 300px;"></div>
          <div class="warning-card warning-red">
            â° è·ç¦»ä¸‹ä¸€æ¬¡æ‹¥å µè¿˜æœ‰ <strong>7å°æ—¶</strong>ï¼Œé¢„è®¡750äººï¼Œç–æ•£æ—¶é—´8åˆ†é’Ÿ
          </div>
          <div class="warning-card warning-blue">
            â° è·ç¦»ç¬¬äºŒæ¬¡æ‹¥å µè¿˜æœ‰ <strong>18å°æ—¶</strong>ï¼Œé¢„è®¡650äººï¼Œç–æ•£æ—¶é—´6åˆ†é’Ÿ
          </div>
        </div>
      </div>
    </div>
    <!-- è½¦ç«™çƒ­åŠ›å›¾æ¨¡å— -->
    <div id="map" class="section container-fluid">
        <h4 class="my-3">ğŸš‡ è½¦ç«™çƒ­åŠ›å›¾</h4>
        <div class="card">
        <div class="card-title">æ¸©å·å—ç«™çƒ­åŠ›å›¾</div>
        <img src="{{ url_for('static', filename='images/heatmap.png') }}" alt="è½¦ç«™çƒ­åŠ›å›¾" class="img-fluid rounded shadow">

            < img src="{{ url_for('static', filename='images/heatmap.png') }}" alt="çƒ­åŠ›å›¾">
        </div>
      </div>
    
    <!-- âœ… å¼•å…¥ Bootstrap å’Œ ECharts -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<!-- âœ… äººæµé‡åˆ—è¡¨æ¨¡å— -->
<div id="list" class="section container-fluid px-4 py-3">
  <h4 class="my-3">ğŸ“‹ äººæµé‡åˆ—è¡¨</h4>

  <div class="row g-2 align-items-center mb-3">
    <div class="col-md-3">
      <input type="text" id="searchInput" class="form-control" placeholder="è¯·è¾“å…¥å®¢æµç‚¹ä½">
    </div>
    <div class="col-auto">
      <button onclick="filterStaticTable()" class="btn btn-primary">ğŸ” æŸ¥è¯¢</button>
    </div>
    <div class="col-auto">
      <button onclick="resetStaticTable()" class="btn btn-secondary">ğŸ”„ é‡ç½®</button>
    </div>
  </div>

  <div id="staticTableContainer"></div>
  <div id="pagination" class="mt-3"></div>
</div>

<!-- âœ… æ›²çº¿å›¾å¼¹çª— -->
<div id="curveModal" class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ğŸ“ˆ å®¢æµé¢„æµ‹æ›²çº¿</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="curveChart" style="height: 300px;"></div>
      </div>
    </div>
  </div>
</div>

<script>
const stationList = [
  '18Wå‡ºç«™å£å³ä¾§æ£€ç¥¨å£6ï¼ˆå®¢ï¼‰', '18Wå‡ºç«™å£å·¦ä¾§æ£€ç¥¨å£7ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤1å®¢æµç»Ÿè®¡å—å³ï¼ˆå®¢ï¼‰', '18Wå‡ºç«™å£å³ä¾§æ£€ç¥¨å£1ï¼ˆå®¢ï¼‰',
  '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡ä¸­é—´ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£è¥¿1ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£åŒ—3ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£åŒ—5ï¼ˆå®¢ï¼‰',
  '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡å³ï¼ˆå¤‡ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£è¥¿4ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿å‡ºç«™å£é—¸æœº3ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£åŒ—1ï¼ˆå®¢ï¼‰',
  '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£å—3ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£è¥¿2ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿å‡ºç«™å£é—¸æœº1ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£è¥¿3ï¼ˆå®¢ï¼‰',
  '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£å—5ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£è¥¿5ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿æ£€ç¥¨å£å—1ï¼ˆå®¢ï¼‰', '18Wå‡ºç«™å£å·¦ä¾§æ£€ç¥¨å£6ï¼ˆå®¢ï¼‰',
  '24Nè¥¿ç«™æˆ¿å‡ºç«™å£é—¸æœº5ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡å³ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤1å®¢æµç»Ÿè®¡å—å·¦ï¼ˆå®¢ï¼‰', '24Nè¥¿ç«™æˆ¿å‡ºç«™å£é—¸æœº2ï¼ˆå®¢ï¼‰',
  '18Wå‡ºç«™å£å³ä¾§æ£€ç¥¨å£7ï¼ˆå®¢ï¼‰', '23Wä¸€ç«™å°å‡ºç«™å£åŒ—ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡ä¸­é—´ï¼ˆå¤‡ï¼‰', '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡å·¦ï¼ˆå¤‡ï¼‰',
  '24Nè¥¿ç«™æˆ¿å‡ºç«™å£é—¸æœº4ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤2å®¢æµç»Ÿè®¡å·¦ï¼ˆå®¢ï¼‰', '23Wä¸€ç«™å°å‡ºç«™å£å—ï¼ˆå®¢ï¼‰', '20Nå€™è½¦å®¤1å®¢æµç»Ÿè®¡åŒ—ï¼ˆå®¢ï¼‰',
  '20Nå€™è½¦å®¤1å®¢æµç»Ÿè®¡å—ä¸­ï¼ˆå®¢ï¼‰'
];

const staticData = stationList.map((name, i) => {
  const base = 20 + Math.floor(Math.random() * 281); // 20 ~ 300
  const variation = Math.floor(Math.random() * 21) - 10; // -10 ~ +10
  return {
    id: i + 1,
    name: name,
    predict: base,
    real: base + variation,
    time: '2024-04-12 10:00'
  };
});



let filteredData = [...staticData];
let currentPage = 1;
const pageSize = 10;

function renderStaticTable() {
  const start = (currentPage - 1) * pageSize;
  const end = start + pageSize;
  const data = filteredData.slice(start, end);
  let html = `<table class='table table-bordered table-hover'>
    <thead class='table-light'><tr>
      <th>åºå·</th><th>å®¢æµç‚¹ä½</th><th>é¢„æµ‹äººæ•°</th><th>å®é™…äººæ•°</th><th>æ›´æ–°æ—¶é—´</th><th>æ“ä½œ</th>
    </tr></thead><tbody>`;
  html += data.map(row => `
    <tr>
      <td>${row.id}</td>
      <td>${row.name}</td>
      <td>${row.predict}</td>
      <td>${row.real}</td>
      <td>${row.time}</td>
      <td>
        <button class='btn btn-outline-info btn-sm' onclick="showCurve('${row.name}')">æ›²çº¿å›¾</button>
        <button class='btn btn-outline-secondary btn-sm' onclick="renderStaticTable()">æ›´æ–°</button>
      </td>
    </tr>`).join('');
  html += '</tbody></table>';
  document.getElementById('staticTableContainer').innerHTML = html;
  renderPagination();
}

function renderPagination() {
  const total = filteredData.length;
  const pages = Math.ceil(total / pageSize);
  let html = `å…± ${total} æ¡æ•°æ®ï¼š`;
  for (let i = 1; i <= pages; i++) {
    html += `<button class='btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}' onclick="goToPage(${i})" style='margin:2px;'>${i}</button>`;
  }
  document.getElementById('pagination').innerHTML = html;
}

function goToPage(p) {
  currentPage = p;
  renderStaticTable();
}

function filterStaticTable() {
  const keyword = document.getElementById('searchInput').value.trim();
  currentPage = 1;
  filteredData = keyword === ''
    ? [...staticData]
    : staticData.filter(d => d.name.includes(keyword));
  renderStaticTable();
}

function resetStaticTable() {
  document.getElementById('searchInput').value = '';
  filteredData = [...staticData];
  currentPage = 1;
  renderStaticTable();
}

function generateMockCurveData(station) {
  const data = [];
  const baseDate = new Date();
  for(let i = 6; i >= 0; i--) {
    const date = new Date(baseDate);
    date.setDate(date.getDate() - i);
    data.push({
      date: date.toISOString().split('T')[0],
      predict: Math.floor(Math.random() * 1000 + 500),
      gt: Math.floor(Math.random() * 1000 + 400)
    });
  }
  return { status: 'success', data };
}

function showCurve(station) {
  const chartDom = document.getElementById('curveChart');
  const modal = new bootstrap.Modal(document.getElementById('curveModal'));
  chartDom.innerHTML = '<div class="text-center p-5">åŠ è½½æ•°æ®ä¸­...</div>';
  modal.show();

  setTimeout(() => {
    chartDom.innerHTML = '';
    const chart = echarts.init(chartDom);
    const res = generateMockCurveData(station);
    chart.setOption({
      title: { text: `${station} â€” æœ€è¿‘7å¤©é¢„æµ‹æ›²çº¿`, left: 'center' },
      tooltip: { trigger: 'axis' },
      legend: { top: 'bottom' },
      xAxis: { type: 'category', data: res.data.map(r => r.date) },
      yAxis: { type: 'value', name: 'äººæ•°' },
      series: [
        {
          name: 'é¢„æµ‹',
          type: 'line',
          data: res.data.map(r => r.predict),
          smooth: true,
          itemStyle: { color: '#67C23A' }
        },
        {
          name: 'å®é™…',
          type: 'line',
          data: res.data.map(r => r.gt),
          smooth: true,
          itemStyle: { color: '#409EFF' }
        }
      ],
      grid: { top: 50, bottom: 70, containLabel: true },
      dataZoom: [{
        type: 'slider',
        show: true,
        start: 0,
        end: 100,
        bottom: 30
      }]
    });
    window.addEventListener('resize', () => chart.resize());
  }, 500);
}

// âœ… åˆå§‹åŒ–åŠ è½½
renderStaticTable();
</script>





</script>
  </div>

<script>
function switchSection(id) {
  ['dashboard', 'map', 'list'].forEach(s => {
    document.getElementById(s).classList.remove('active-section');
    document.getElementById('nav-' + s).classList.remove('active');
  });
  document.getElementById(id).classList.add('active-section');
  document.getElementById('nav-' + id).classList.add('active');
}


// æ€§åˆ«æ¯”ä¾‹å›¾
const pie = echarts.init(document.getElementById('pieChart'));
pie.setOption({
  tooltip: { trigger: 'item', formatter: '{b}: {c} äºº ({d}%)' },
  legend: { top: 'bottom' },
  series: [{
    type: 'pie',
    radius: ['50%', '70%'],
    label: {
      show: true,
      formatter: '{b}: {c}äºº ({d}%)',
      position: 'outside'
    },
    data: [
      { value: 270, name: 'å¥³æ€§', itemStyle: { color: '#73c0de' } },
      { value: 330, name: 'ç”·æ€§', itemStyle: { color: '#5470c6' } }
    ]
  }]
});

// æŠ˜çº¿å›¾
const line = echarts.init(document.getElementById('lineChart'));
line.setOption({
  tooltip: { trigger: 'axis' },
  xAxis: {
    type: 'category',
    boundaryGap: false,
    data: [
      '00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00',
      '12:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00'
    ]
  },
  yAxis: { type: 'value' },
  series: [{
    name: 'å®¢æµé‡',
    type: 'line',
    smooth: true,
    data: [120,100,90,80,75,70,95,200,300,380,420,450,500,480,470,430,410,390,350,300,260,200,150,100]
  }]
});

// åˆå§‹åŒ–åŠ è½½
renderStaticTable();
</script>
</body>
</html>



<!-- function loadFlowList(page = 1) {
  const keyword = document.getElementById('searchInput').value;
  const date = document.getElementById('dateInput').value;
  const clock = document.getElementById('clockInput').value;

  fetch(`/getcurrentflow?date=${date}&clock=${clock}&keyword=${keyword}&page=${page}&size=${pageSize}`)
    .then(res => res.json())
    .then(res => {
      if (res.status === 'success') {
        const data = res.data;
        totalItems = res.total;
        currentPage = page;
        let html = `<table class='table table-bordered table-hover'><thead class='table-light'><tr><th>åºå·</th><th>å®¢æµç‚¹ä½</th><th>é¢„æµ‹äººæ•°</th><th>å®é™…äººæ•°</th><th>æ›´æ–°æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>`;
        html += data.map(row => `
          <tr>
            <td>${row.id}</td>
            <td>${row.name}</td>
            <td>${row.predict}</td>
            <td>${row.real}</td>
            <td>${row.time}</td>
            <td>
              <button class='btn btn-outline-info btn-sm' onclick=\"showCurve('${row.name}')\">æ›²çº¿å›¾</button>
              <button class='btn btn-outline-secondary btn-sm' onclick=\"loadFlowList(${currentPage})\">æ›´æ–°</button>
            </td>
          </tr>`).join('') + '</tbody></table>';
        document.getElementById('stationData').innerHTML = html;
        renderPagination();
      } else {
        document.getElementById('stationData').textContent = 'åŠ è½½å¤±è´¥';
      }
    });
}

function renderPagination() {
  const totalPages = Math.ceil(totalItems / pageSize);
  const container = document.getElementById('pagination');
  container.innerHTML = `å…± ${totalItems} æ¡æ•°æ®ï¼š `;
  for (let i = 1; i <= totalPages; i++) {
    container.innerHTML += `<button class='btn btn-sm ${i === currentPage ? "btn-primary" : "btn-outline-primary"}' style='margin: 2px;' onclick='loadFlowList(${i})'>${i}</button>`;
  }
}

function resetFlowSearch() {
  document.getElementById('searchInput').value = '';
  document.getElementById('dateInput').value = '';
  document.getElementById('clockInput').value = '10:00';
  loadFlowList(1);
}

function exportFlowList() {
  const rows = document.querySelectorAll('#stationData table tbody tr');
  if (!rows.length) return alert('æš‚æ— æ•°æ®');
  let csv = 'åºå·,å®¢æµç‚¹ä½,é¢„æµ‹äººæ•°,å®é™…äººæ•°,æ›´æ–°æ—¶é—´'
  rows.forEach(row => {
    const cols = row.querySelectorAll('td');
    csv += [...cols].slice(0, 5).map(td => td.innerText).join(',') + ''
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'äººæµé‡åˆ—è¡¨.csv';
  a.click();
  URL.revokeObjectURL(url);
} -->



